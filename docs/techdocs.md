# Tokyo Sounds Tech Guide

## プロジェクト概要

### 東京サウンドズ - 3Dインタラクティブ地図とAI音楽生成の融合

本日は、Google Maps 3D Tiles APIとThree.jsを活用し、東京の立體地図を生成し、ユーザーの現在位置に応じて実地の背景音を再生し、さらにAIがリアルタイムでその地域の雰囲気に合った背景音楽を生成するウェブサイトをご紹介します。
このプロジェクトは、Next.jsを基盤とし、React Three Fiberで3Dレンダリングを実現しています。Google Maps 3D Tiles APIにより、東京の建物や街並みを立体的に再現し、ユーザーは仮想的に東京の上空を飛行しながら、リアルな都市景観を体験できます。
音では、Google Places APIでユーザーの周辺のPOI（駅、神社、商業施設など）を取得し、各地点に配置された実地録音の背景音を空間音響として再生します。これにより、新宿エリアでは電車のアナウンスが、浅草エリアでは伝統的な祭りの音が聞こえるなど、地域ごとの音環境を再現します。
さらに、Google Lyriaのリアルタイム音楽生成機能を統合し、ユーザーの位置に応じて、その地域の雰囲気に合わせた音楽をリアルタイムで生成・再生します。例えば、新宿ではネオンに彩られた夜のエレクトロニックビート、浅草では伝統的な和太鼓や三味線の音色が反映されます。各エリアには独自のプロンプトが設定されており、12の主要エリア（新宿、渋谷、東京駅、池袋、銀座、秋葉原、浅草、六本木、品川、上野、原宿、恵比寿）それぞれに特徴的な音楽が生成されます。
技術的には、ECEF座標系からENU座標系への変換により、東京を中心としたローカル座標系で3Dタイルを表示し、カメラの位置に基づいて動的にPOIを取得し、距離に応じた空間音響の減衰を実装しています。また、Lyria APIとのWebSocket接続により、低遅延で音楽生成を行い、ユーザーの移動に即座に反応して音楽が変化します。
このプロジェクトは、視覚的な3D体験と音響体験、そしてAIによる動的な音楽生成を統合し、東京という都市を多層的に体験できる新しい形のデジタルアート作品となっています。ユーザーは、まるで紙飛行機に乗って東京の上空を飛んでいるような感覚で、各エリアの独特な雰囲気を視覚と音響の両面から楽しむことができます。
ご清聴ありがとうございました。

**Tokyo Sounds（東京の声）**は、東京の日常音を収集・体験できるASMR型Webアプリケーションです。視覚ではなく「音」を通じて東京の街を旅する新しい体験を提供します。

## 技術スタック

### フロントエンド

- **Next.js 16.0.7** (App Router)
- **React 19.2.1**
- **TypeScript 5.9.3**
- **Tailwind CSS 4.1.17**

### 3Dグラフィックス

- **Three.js 0.180.0** - 3Dレンダリングエンジン
- **@react-three/fiber 9.4.0** - React用Three.jsラッパー
- **@react-three/drei 10.7.7** - Three.jsヘルパー
- **3d-tiles-renderer 0.4.18** - 3Dタイルレンダリング
- **camera-controls 3.1.2** - カメラ制御

### AI音声生成

- **@google/genai 1.30.0** - Google Gemini API
- **Lyria Realtime API** - リアルタイム音声生成
- **Web Audio API** - 音声処理・再生

### 音声ライブラリ

- **howler 2.2.4** - オーディオプレーヤー
- **tone 15.1.22** - 音声合成・エフェクト

### バックエンド・データベース

- **Prisma 7.1.0** - ORM
- **PostgreSQL** - データベース
- **Better Auth 1.4.5** - 認証システム
  - Email/Password認証
  - OAuth (GitHub, Google)

### 状態管理・UI

- **Zustand 5.0.8** - 状態管理
- **@radix-ui** - UIコンポーネント
- **motion 12.23.25** - アニメーション
- **lucide-react** - アイコン

### 開発ツール

- **Vitest** - テストフレームワーク
- **ESLint** - リンター
- **pnpm** - パッケージマネージャー

## 主要機能

### 1. 3D都市ビジュアライゼーション

- 手続き型生成による建物配置
- 4つのプレート（地区）システム
- 音声マッピング対応の建物オブジェクト
- Google Tiles統合による地図表示

### 2. リアルタイム生成音声

- Gemini Lyria Realtime APIによる音声生成
- 重み付けプロンプトシステム
- 位置情報に基づく音声ブレンド
- リアルタイムストリーミング再生

### 3. 認証システム

- Better Authによる認証
- メール/パスワード認証
- GitHub/Google OAuth
- セッション管理

### 4. その他機能

- クイズゲーム
- 音声ライブラリ
- プロフィール管理
- デバッグパネル

## アーキテクチャ

### ディレクトリ構造

```
src/
├── app/              # Next.js App Router
│   ├── about/        # アバウトページ
│   ├── city/         # 3D都市シーン
│   ├── library/      # 音声ライブラリ
│   └── profile/      # ユーザープロフィール
├── components/       # Reactコンポーネント
│   ├── city/         # 都市関連コンポーネント
│   ├── audio/        # 音声関連
│   └── ui/           # UIコンポーネント
├── hooks/            # カスタムフック
├── lib/              # ユーティリティ
├── stores/           # Zustandストア
└── types/             # TypeScript型定義
```

### データフロー

1. ユーザーが3Dシーン内で位置を選択
2. 位置情報から重み付けプロンプトを計算
3. Gemini Lyria APIにプロンプトを送信
4. リアルタイムで音声チャンクを受信
5. Web Audio APIでデコード・再生
6. 3Dビジュアライゼーションと同期

## 技術的特徴

- **リアルタイム音声生成**: Gemini Lyria APIによる低遅延音声生成
- **空間的音声マッピング**: 位置情報に基づく音声の重み付け
- **手続き型3D生成**: 動的な都市シーンの生成
- **型安全**: TypeScriptによる完全な型定義
- **モダンなReact**: React 19の最新機能を活用
- **サーバーレス対応**: Next.js App Routerによる効率的なルーティング

## 開発環境

- **Node.js**: 最新LTS
- **パッケージマネージャー**: pnpm
- **データベース**: PostgreSQL
- **環境変数**: `.env.local`で管理

## デプロイ

- **ビルド**: `pnpm build` (Prisma生成 + Next.jsビルド)
- **開発サーバー**: `pnpm dev`
- **本番**: Vercel推奨

---

**最終更新**: 2025年1月
